@{
  ViewData["Title"] = "Store";
}

@section VendorStyles {
  <link rel="stylesheet" href="~/vendor/libs/select2/select2.css" />
  <link rel="stylesheet" href="~/vendor/libs/bs-stepper/bs-stepper.css" />
  <link rel="stylesheet" href="~/vendor/libs/rateyo/rateyo.css" />
  <link rel="stylesheet" href="~/vendor/libs/&#64;form-validation/form-validation.css" />
}

@section VendorScripts {
  <script src="~/vendor/libs/jquery/jquery.js"></script>
  <script src="~/vendor/libs/select2/select2.js"></script>
  <script src="~/vendor/libs/bs-stepper/bs-stepper.js"></script>
  <script src="~/vendor/libs/rateyo/rateyo.js"></script>
  <script src="~/vendor/libs/cleavejs/cleave.js"></script>
  <script src="~/vendor/libs/cleavejs/cleave-phone.js"></script>
  <script src="~/vendor/libs/&#64;form-validation/popular.js"></script>
  <script src="~/vendor/libs/&#64;form-validation/bootstrap5.js"></script>
  <script src="~/vendor/libs/&#64;form-validation/auto-focus.js"></script>
}

<div class="container-xxl flex-grow-1 container-p-y" id="store-content">
  <!-- Search Bar -->
  <div class="mb-4">
    <div class="input-group">
      <span class="input-group-text"><i class="bx bx-search"></i></span>
      <input type="text" class="form-control" placeholder="Search product name">
    </div>
  </div>

  <div class="row">
    <!-- Main Content - Product Grid -->
    <div class="col-lg-7">
      <h4 class="fw-bold mb-4">Store</h4>
      
      <div class="row g-4">
        <!-- Product Card 1 -->
        <div class="col-md-4">
          <div class="card product-card" data-product-id="1">
            <div class="card-body text-center">
              <img src="~/img/discounts/pc.png" alt="Point of Sale" class="img-fluid mb-3" style="max-height: 150px;">
              <h6 class="card-title">Point of Sale</h6>
              <p class="text-muted small mb-2">183.7 × 149.88</p>
              <div class="price mb-3" data-price="200.00">$200.00</div>
              <button class="btn btn-outline-dark add-to-cart-btn" style="font-size:0.95rem; padding:0.35rem 0.7rem;" data-product-id="1" data-product-name="Point of Sale" data-product-price="200.00">
                Add To Cart
              </button>
            </div>
          </div>
        </div>

        <!-- Product Card 2 -->
        <div class="col-md-4">
          <div class="card product-card" data-product-id="2">
            <div class="card-body text-center">
              <img src="~/img/discounts/pc.png" alt="Point of Sale" class="img-fluid mb-3" style="max-height: 150px;">
              <h6 class="card-title">Point of Sale</h6>
              <p class="text-muted small mb-2">183.7 × 149.88</p>
              <div class="price mb-3" data-price="200.00">$200.00</div>
                             <button class="btn btn-outline-dark add-to-cart-btn" style="font-size:0.95rem; padding:0.35rem 0.7rem;" data-product-id="2" data-product-name="Point of Sale" data-product-price="200.00">
                 Add To Cart
               </button>
             </div>
           </div>
         </div>

         <!-- Product Card 3 -->
         <div class="col-md-4">
           <div class="card product-card" data-product-id="3">
             <div class="card-body text-center">
               <img src="~/img/discounts/pc.png" alt="Point of Sale" class="img-fluid mb-3" style="max-height: 150px;">
               <h6 class="card-title">Point of Sale</h6>
               <p class="text-muted small mb-2">183.7 × 149.88</p>
               <div class="price mb-3" data-price="200.00">$200.00</div>
               <button class="btn btn-outline-dark add-to-cart-btn" style="font-size:0.95rem; padding:0.35rem 0.7rem;" data-product-id="3" data-product-name="Point of Sale" data-product-price="200.00">
                 Add To Cart
               </button>
             </div>
           </div>
         </div>

         <!-- Product Card 4 -->
         <div class="col-md-4">
           <div class="card product-card" data-product-id="4">
             <div class="card-body text-center">
               <img src="~/img/discounts/pc.png" alt="Point of Sale" class="img-fluid mb-3" style="max-height: 150px;">
               <h6 class="card-title">Point of Sale</h6>
               <p class="text-muted small mb-2">183.7 × 149.88</p>
               <div class="price mb-3" data-price="200.00">$200.00</div>
               <button class="btn btn-outline-dark add-to-cart-btn" style="font-size:0.95rem; padding:0.35rem 0.7rem;" data-product-id="4" data-product-name="Point of Sale" data-product-price="200.00">
                 Add To Cart
               </button>
             </div>
           </div>
         </div>

         <!-- Product Card 5 -->
         <div class="col-md-4">
           <div class="card product-card" data-product-id="5">
             <div class="card-body text-center">
               <img src="~/img/discounts/pc.png" alt="Point of Sale" class="img-fluid mb-3" style="max-height: 150px;">
               <h6 class="card-title">Point of Sale</h6>
               <p class="text-muted small mb-2">183.7 × 149.88</p>
               <div class="price mb-3" data-price="200.00">$200.00</div>
               <button class="btn btn-outline-dark add-to-cart-btn" style="font-size:0.95rem; padding:0.35rem 0.7rem;" data-product-id="5" data-product-name="Point of Sale" data-product-price="200.00">
                 Add To Cart
               </button>
             </div>
           </div>
         </div>

         <!-- Product Card 6 -->
         <div class="col-md-4">
           <div class="card product-card" data-product-id="6">
             <div class="card-body text-center">
               <img src="~/img/discounts/pc.png" alt="Point of Sale" class="img-fluid mb-3" style="max-height: 150px;">
               <h6 class="card-title">Point of Sale</h6>
               <p class="text-muted small mb-2">183.7 × 149.88</p>
               <div class="price mb-3" data-price="200.00">$200.00</div>
               <button class="btn btn-outline-dark add-to-cart-btn" style="font-size:0.95rem; padding:0.35rem 0.7rem;" data-product-id="6" data-product-name="Point of Sale" data-product-price="200.00">
                 Add To Cart
               </button>
             </div>
           </div>
         </div>

         <!-- Product Card 7 -->
         <div class="col-md-4">
           <div class="card product-card" data-product-id="7">
             <div class="card-body text-center">
               <img src="~/img/discounts/pc.png" alt="Point of Sale" class="img-fluid mb-3" style="max-height: 150px;">
               <h6 class="card-title">Point of Sale</h6>
               <p class="text-muted small mb-2">183.7 × 149.88</p>
               <div class="price mb-3" data-price="200.00">$200.00</div>
               <button class="btn btn-outline-dark add-to-cart-btn" style="font-size:0.95rem; padding:0.35rem 0.7rem;" data-product-id="7" data-product-name="Point of Sale" data-product-price="200.00">
                 Add To Cart
               </button>
             </div>
           </div>
         </div>

         <!-- Product Card 8 -->
         <div class="col-md-4">
           <div class="card product-card" data-product-id="8">
             <div class="card-body text-center">
               <img src="~/img/discounts/pc.png" alt="Point of Sale" class="img-fluid mb-3" style="max-height: 150px;">
               <h6 class="card-title">Point of Sale</h6>
               <p class="text-muted small mb-2">183.7 × 149.88</p>
               <div class="price mb-3" data-price="200.00">$200.00</div>
               <button class="btn btn-outline-dark add-to-cart-btn" style="font-size:0.95rem; padding:0.35rem 0.7rem;" data-product-id="8" data-product-name="Point of Sale" data-product-price="200.00">
                 Add To Cart
               </button>
             </div>
           </div>
         </div>

         <!-- Product Card 9 -->
         <div class="col-md-4">
           <div class="card product-card" data-product-id="9">
             <div class="card-body text-center">
               <img src="~/img/discounts/pc.png" alt="Point of Sale" class="img-fluid mb-3" style="max-height: 150px;">
               <h6 class="card-title">Point of Sale</h6>
               <p class="text-muted small mb-2">183.7 × 149.88</p>
               <div class="price mb-3" data-price="200.00">$200.00</div>
               <button class="btn btn-outline-dark add-to-cart-btn" style="font-size:0.95rem; padding:0.35rem 0.7rem;" data-product-id="9" data-product-name="Point of Sale" data-product-price="200.00">
                 Add To Cart
               </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Shopping Cart Sidebar -->
    <div class="col-lg-5">
      <div class="card" style="min-height: 400px; max-width: 370px; margin-left: 0;">
        <div class="card-header">
          <h5 class="card-title mb-0">Shopping</h5>
        </div>
        <div class="card-body d-flex flex-column">
          <div id="cart-items" class="flex-grow-1">
            <!-- Cart items will be dynamically added here -->
          </div>
          <div class="d-flex justify-content-between mt-auto gap-2">
            <button class="btn btn-outline-secondary btn-sm px-3" style="font-size: 0.95rem;" onclick="closeCart()">Close</button>
            <button class="btn btn-sm px-3" style="background-color: #fd7e14; color: white; border-color: #fd7e14; font-size: 0.95rem;" onclick="checkout()">Check Out</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Checkout Content (Hidden by default) -->
<div id="checkout-content" style="display: none;">
  <div class="container-xxl flex-grow-1 container-p-y">
    <!-- Store Title as Back Button -->
    <div class="mb-4">
      <h4 class="fw-bold mb-0" style="cursor:pointer;display:inline-block;" onclick="backToStore()">Store</h4>
    </div>
    <div class="row g-4">
      <!-- Shopping Cart Section -->
      <div class="col-lg-8">
        <div class="cart-section card p-4" style="background: #fff; border-radius: 12px;">
          <h5 class="mb-4">Shopping Cart</h5>
          <div class="table-responsive">
            <table class="table mb-0">
              <thead>
                <tr style="border-bottom: 2px solid #f0f0f0;">
                  <th class="fw-bold">PRODUCT</th>
                  <th class="fw-bold">QUANTITY</th>
                  <th class="fw-bold">PRICE</th>
                </tr>
              </thead>
              <tbody id="checkout-cart-items">
                <!-- Cart items will be populated here -->
              </tbody>
            </table>
          </div>
          <button class="btn btn-outline-secondary mt-4" onclick="resetOrder()">Reset order</button>
        </div>
      </div>

      <!-- Right Side: Coupon, Summary, Payment -->
      <div class="col-lg-4">
        <div class="card p-0" style="background: #fff; border-radius: 12px;">
          <!-- Coupon Code (vertical layout) -->
          <div class="p-4 border-bottom" style="border-color: #f0f0f0 !important;">
            <h6 class="card-title mb-3">Coupon code.</h6>
            <div class="d-flex flex-column gap-2">
              <input type="text" class="form-control" placeholder="Enter Your Coupon Code" style="flex:1;">
              <button class="btn w-100" style="background-color: #fd7e14; color: white; border-color: #fd7e14; min-width: 160px; font-size: 0.98rem; padding: 0.45rem 0;">Apply Your Coupon</button>
            </div>
          </div>
          <!-- Order Summary -->
          <div class="p-4 border-bottom" style="border-color: #f0f0f0 !important;">
            <h6 class="card-title mb-3">Order Summary.</h6>
            <div class="d-flex justify-content-between mb-2">
              <span>Discount:</span>
              <span>$00.00</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Delivery:</span>
              <span>$29.00</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Tax:</span>
              <span>$39.00</span>
            </div>
            <hr style="margin: 0.5rem 0; border-color: #f0f0f0;">
            <div class="d-flex justify-content-between fw-bold">
              <span>Total:</span>
              <span id="checkout-total">$39.00</span>
            </div>
          </div>
          <!-- Payment -->
          <div class="p-4">
            <h6 class="card-title mb-3">Payment.</h6>
            <div class="d-flex gap-2 mb-3">
              <div class="payment-method">
                <i class="bx bxl-paypal" style="font-size: 2rem; color: #0070ba;"></i>
              </div>
              <div class="payment-method">
                <i class="bx bxl-mastercard" style="font-size: 2rem; color: #eb001b;"></i>
              </div>
              <div class="payment-method">
                <span style="font-size: 2rem; font-weight: bold; color: #6772e5;">S</span>
              </div>
              <div class="payment-method">
                <span style="font-size: 2rem; font-weight: bold; color: #f7931a;">₿</span>
              </div>
            </div>
            <button class="btn w-100" style="background-color: #fd7e14; color: white; border-color: #fd7e14; font-size: 1.1rem;">Pay</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let cart = [];
let cartTotal = 0;

// Add to cart functionality
document.querySelectorAll('.add-to-cart-btn').forEach(button => {
  button.addEventListener('click', function() {
    const productId = this.getAttribute('data-product-id');
    const productName = this.getAttribute('data-product-name');
    const productPrice = parseFloat(this.getAttribute('data-product-price'));
    
    // Check if product already in cart
    const existingItem = cart.find(item => item.id === productId);
    
    if (existingItem) {
      existingItem.quantity += 1;
    } else {
      cart.push({
        id: productId,
        name: productName,
        price: productPrice,
        quantity: 1
      });
    }
    
    // Update button text and style
    this.textContent = 'Added';
    this.classList.remove('btn-outline-dark');
    this.classList.add('btn-outline-warning');
    
    updateCart();
  });
});

function updateCart() {
  const cartContainer = document.getElementById('cart-items');
  cartContainer.innerHTML = '';
  
  cart.forEach(item => {
    const cartItem = document.createElement('div');
    cartItem.className = 'd-flex align-items-center mb-2 p-2';
    cartItem.style.border = '1px solid #e0e0e0';
    cartItem.style.borderRadius = '8px';
    cartItem.style.background = '#fff';
    cartItem.innerHTML = `
      <img src="/img/discounts/pc.png" alt="${item.name}" class="me-2" style="width: 36px; height: 36px; object-fit: cover; border-radius: 6px;">
      <div class="flex-grow-1" style="min-width:0;">
        <div class="fw-semibold" style="font-size: 0.98rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${item.name}</div>
        <div class="text-muted" style="font-size: 0.85rem;">$${item.price.toFixed(2)}</div>
      </div>
      <div class="d-flex align-items-center ms-2">
        <button class="btn btn-sm btn-outline-secondary rounded-pill me-1" style="width:28px;height:28px;padding:0;" onclick="updateQuantity('${item.id}', -1)">-</button>
        <span class="mx-1" style="font-size:0.98rem; min-width:18px; text-align:center;">${item.quantity}</span>
        <button class="btn btn-sm btn-outline-secondary rounded-pill ms-1" style="width:28px;height:28px;padding:0;" onclick="updateQuantity('${item.id}', 1)">+</button>
      </div>
    `;
    cartContainer.appendChild(cartItem);
  });
}

function updateQuantity(productId, change) {
  const item = cart.find(item => item.id === productId);
  if (item) {
    item.quantity += change;
    if (item.quantity <= 0) {
      cart = cart.filter(item => item.id !== productId);
      // Reset button to "Add To Cart"
      const button = document.querySelector(`[data-product-id="${productId}"]`);
      button.textContent = 'Add To Cart';
      button.classList.remove('btn-outline-warning');
      button.classList.add('btn-outline-dark');
    }
    updateCart();
  }
}

function closeCart() {
  // Reset all buttons
  document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.textContent = 'Add To Cart';
    button.classList.remove('btn-outline-warning');
    button.classList.add('btn-outline-dark');
  });
  cart = [];
  updateCart();
}

function checkout() {
  if (cart.length === 0) {
    alert('Your cart is empty!');
    return;
  }
  
  // Populate checkout content
  const checkoutCartItems = document.getElementById('checkout-cart-items');
  checkoutCartItems.innerHTML = '';
  
  let total = 0;
  cart.forEach(item => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td style="vertical-align:middle;">
        <div class="d-flex align-items-center p-2" style="border:1px solid #e0e0e0; border-radius:8px; background:#fff;">
          <img src="/img/discounts/pc.png" alt="${item.name}" class="me-3" style="width: 50px; height: 50px; object-fit: cover;">
          <div>
            <h6 class="mb-0">${item.name}</h6>
            <small class="text-muted">Lorem Ipsum is simply dummy text of the Characteristic.</small>
          </div>
        </div>
      </td>
      <td style="vertical-align:middle;">
        <div class="d-flex align-items-center justify-content-center">
          <button class="btn btn-sm btn-outline-secondary rounded-pill me-2" style="width:32px;height:32px;" onclick="updateCheckoutQuantity('${item.id}', -1)">-</button>
          <input type="number" class="form-control form-control-sm mx-2 text-center" style="width: 60px;" value="${item.quantity}" min="0" onchange="updateCheckoutQuantity('${item.id}', 0, this.value)">
          <button class="btn btn-sm btn-outline-secondary rounded-pill ms-2" style="width:32px;height:32px;" onclick="updateCheckoutQuantity('${item.id}', 1)">+</button>
        </div>
      </td>
      <td style="vertical-align:middle;">$${(item.price * item.quantity).toFixed(2)}</td>
    `;
    checkoutCartItems.appendChild(row);
    total += item.price * item.quantity;
  });
  
  // Add delivery and tax
  const delivery = 29.00;
  const tax = 39.00;
  total += delivery + tax;
  
  document.getElementById('checkout-total').textContent = `$${total.toFixed(2)}`;
  
  // Hide store content and show checkout content
  document.getElementById('store-content').style.display = 'none';
  document.getElementById('checkout-content').style.display = 'block';
}

function updateCheckoutQuantity(productId, change, newValue = null) {
  const item = cart.find(item => item.id === productId);
  if (item) {
    if (newValue !== null) {
      item.quantity = parseInt(newValue);
    } else {
      item.quantity += change;
    }
    
    if (item.quantity <= 0) {
      cart = cart.filter(item => item.id !== productId);
    }
    
    checkout(); // Refresh the checkout modal
  }
}

function resetOrder() {
  cart = [];
  updateCart();
  checkout(); // Refresh the checkout content
}

function backToStore() {
  document.getElementById('checkout-content').style.display = 'none';
  document.getElementById('store-content').style.display = 'block';
}
</script>

<style>
body { background: #f7f7fa; }
.cart-section { box-shadow: 0 2px 16px rgba(0,0,0,0.04); }
.payment-method {
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid #ddd;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: #fff;
}
.payment-method:hover {
  border-color: #fd7e14;
  transform: scale(1.1);
}
</style> 