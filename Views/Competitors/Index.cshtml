@model RestoHive_Reseller.Models.CompetitorsViewModel
@using System.Linq
@{
    ViewData["Title"] = "Competitors";
    var restoIcon = Url.Content("~/img/competitors/group.png");
    var sectionImage = Url.Content("~/img/competitors/sect.png");
}

<div class="competitors-page">
    <!-- Carousel row right after search bar -->
    <div class="top-section mb-3">
        <div class="row g-3 align-items-center">
            <!-- Carousel -->
            <div class="col-12 col-lg-10">
                <div class="competitor-carousel">
                    <button class="carousel-btn carousel-btn-left" aria-label="Previous">
                        <i class="bx bx-chevron-left"></i>
                    </button>

                    <div class="competitor-items">
                        @for (int i = 0; i < 8; i++)
                        {
                            var isActive = i == 0;
                            <div class="competitor-item @(isActive ? "active" : "")">
                                <div class="competitor-icon">
                                    <img src="@restoIcon" alt="Resto POS" class="resto-icon-img" />
                                </div>
                                <span class="competitor-name">Resto POS</span>
                            </div>
                        }
                    </div>

                    <button class="carousel-btn carousel-btn-right" aria-label="Next">
                        <i class="bx bx-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Add Competitor Button -->
            <div class="col-12 col-lg-2">
                <button class="btn btn-add-competitor w-100">
                    Add competitor +
                </button>
            </div>
        </div>
    </div>

    <!-- Static comparison image section -->
    <div class="comparison-image-wrapper">
        <img src="@sectionImage" alt="Competitors Comparison" class="comparison-image" />
    </div>
</div>

<!-- Add Competitor Panel (Right Offcanvas) -->
<div class="offcanvas offcanvas-end offcanvas-competitor" tabindex="-1" id="addCompetitorPanel" aria-labelledby="addCompetitorLabel" data-bs-scroll="false" data-bs-backdrop="true">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title fw-bold" id="addCompetitorLabel">New Competitor</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body pt-0">
    <form id="competitorForm">
      <div class="row g-3">
        <div class="col-12">
          <label class="form-label">Name</label>
          <input type="text" class="form-control" name="name" placeholder="Clover POS" required />
        </div>
        <div class="col-12">
          <label class="form-label">Phone number</label>
          <input type="tel" class="form-control" name="phone" placeholder="5143832345" />
        </div>
        <div class="col-12">
          <label class="form-label">Country</label>
          <select class="form-select" name="country">
            <option value="" selected>Choose...</option>
            <option>United States</option>
            <option>Canada</option>
            <option>United Kingdom</option>
            <option>Australia</option>
          </select>
        </div>
        <div class="col-12">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" name="email" placeholder="jake@gmail.com" />
        </div>
        <div class="col-12">
          <label class="form-label">Website</label>
          <input type="url" class="form-control" name="website" placeholder="https://restohive.com/" />
        </div>
        <div class="col-12">
          <label class="form-label">Details</label>
          <textarea class="form-control" name="details" rows="3" placeholder="Features, 24/7 support and configurations services free, include KDS kitchen screen,..."></textarea>
        </div>
        <div class="col-12">
          <label class="form-label">Price / month</label>
          <div class="input-group">
            <input type="number" step="0.01" class="form-control" name="price" placeholder="18.00" />
            <span class="input-group-text">$</span>
          </div>
        </div>
        <div class="col-12">
          <label class="form-label">Upload Logo</label>
          <input type="file" class="d-none" id="logoInput" accept="image/*" />
          <button type="button" class="btn btn-upload w-100 d-flex align-items-center justify-content-center gap-2" id="logoBtn">
            <i class='bx bx-image-alt'></i>
            <span>Upload Logo</span>
          </button>
          <div class="small text-muted mt-1" id="logoName"></div>
        </div>
        <div class="col-12">
          <label class="form-label">Upload Features Screenshot</label>
          <input type="file" class="d-none" id="featuresInput" accept="image/*" />
          <button type="button" class="btn btn-upload w-100 d-flex align-items-center justify-content-center gap-2" id="featuresBtn">
            <i class='bx bx-image-add'></i>
            <span>Upload Features Screenshot</span>
          </button>
          <div class="small text-muted mt-1" id="featuresName"></div>
        </div>
      </div>
      <div class="d-flex justify-content-end gap-2 pt-3 border-top mt-3">
        <button type="button" class="btn btn-light" data-bs-dismiss="offcanvas">Cancel</button>
        <button type="submit" class="btn btn-primary btn-request">Request</button>
      </div>
    </form>
  </div>
</div>

<style>
/* Image icons for Resto POS */
.resto-icon-img { width: 16px; height: 16px; object-fit: contain; display: block; }

.competitors-page { padding: .75rem 1rem 1.5rem; background-color: #f8f9fa; min-height: 100vh; }

/* Top Section (carousel bar) */
.top-section { background: #dedede; border-radius: 10px; padding: .4rem .6rem; box-shadow: 0 2px 6px rgba(0,0,0,0.06); height: 82px; display: flex; align-items: center; }
.competitor-carousel { display: flex; align-items: center; gap: .4rem; }
.carousel-btn { background: transparent; border: 0; color: #f07d00; width: 26px; height: 26px; display: inline-flex; align-items: center; justify-content: center; font-size: 1rem; border-radius: 6px; }
.carousel-btn:hover { background: rgba(240,125,0,0.1); }
.competitor-items { display: flex; gap: .9rem; overflow: hidden; flex: 1; padding: .1rem 0; scrollbar-width: none; -ms-overflow-style: none; }
.competitor-items::-webkit-scrollbar { display: none; }
.competitor-item { display: inline-flex; flex-direction: column; align-items: center; justify-content: center; gap: .2rem; padding: .25rem .5rem; border-radius: 14px; transition: background-color .2s ease; min-width: 76px; }
.competitor-item.active { background: #dfe9aa; }
.competitor-icon { width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; }
.competitor-name { font-size: .8rem; font-weight: 800; color: #111827; white-space: nowrap; line-height: 1; text-align: center; }

/* Comparison image */
.comparison-image-wrapper { height: 731px; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.comparison-image { width: 100%; height: 100%; object-fit: cover; display: block; }

/* Buttons */
.btn-add-competitor { background: #f07d00; color: #fff; border: none; border-radius: 10px; padding: .65rem .85rem; font-weight: 800; box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
.btn-add-competitor:hover { background: #e26f00; }

/* Offcanvas (right panel) */
.offcanvas-competitor { width: 30vw; max-width: 540px; min-width: 360px; } .offcanvas-competitor .offcanvas-body{ overflow-y:auto; max-height:calc(100vh - 64px); padding-bottom:1rem;} .offcanvas-competitor .offcanvas-header{ border-bottom:0; }
@@media (max-width: 992px) { .offcanvas-competitor { width: 90vw; min-width: auto; } }
.btn-upload { background: #f07d00; color: #fff; height: 48px; } .input-group-text{ background:#f2f3f5; }
.btn-upload:hover { background: #e26f00; color: #fff; }
.btn-request { background: #f07d00; border-color: #f07d00; }
.btn-request:hover { background: #e26f00; border-color: #e26f00; }

/* Responsive */
@@media (max-width: 768px) {
  .competitors-page { padding: .6rem; }
  .top-section { padding: .45rem; }
  .competitor-items { gap: .7rem; }
}
</style>

<script>
// Slide carousel with arrows; scrollbar hidden
document.addEventListener('DOMContentLoaded', function () {
  const container = document.querySelector('.competitor-items');
  const left = document.querySelector('.carousel-btn-left');
  const right = document.querySelector('.carousel-btn-right');
  if (container && left && right) {
    const getStep = () => {
      const first = container.querySelector('.competitor-item');
      const gap = parseFloat(getComputedStyle(container).gap || 0);
      return (first ? first.getBoundingClientRect().width : 100) + gap;
    };
    left.addEventListener('click', () => container.scrollBy({ left: -getStep(), behavior: 'smooth' }));
    right.addEventListener('click', () => container.scrollBy({ left: getStep(), behavior: 'smooth' }));
  }

  // Open right panel on button click
  const addBtn = document.querySelector('.btn-add-competitor');
  const panelEl = document.getElementById('addCompetitorPanel');
  if (addBtn && panelEl) {
    addBtn.addEventListener('click', function () {
      const panel = new bootstrap.Offcanvas(panelEl);
      panel.show();
    });
  }

  // Upload buttons
  const logoBtn = document.getElementById('logoBtn');
  const logoInput = document.getElementById('logoInput');
  const logoName = document.getElementById('logoName');
  if (logoBtn && logoInput) {
    logoBtn.addEventListener('click', () => logoInput.click());
    logoInput.addEventListener('change', () => { logoName.textContent = logoInput.files?.[0]?.name || ''; });
  }
  const featuresBtn = document.getElementById('featuresBtn');
  const featuresInput = document.getElementById('featuresInput');
  const featuresName = document.getElementById('featuresName');
  if (featuresBtn && featuresInput) {
    featuresBtn.addEventListener('click', () => featuresInput.click());
    featuresInput.addEventListener('change', () => { featuresName.textContent = featuresInput.files?.[0]?.name || ''; });
  }

  // Basic submit handler 
  const form = document.getElementById('competitorForm');
  if (form) {
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      bootstrap.Offcanvas.getInstance(panelEl)?.hide();
    });
  }
});
</script>
